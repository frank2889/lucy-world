import{r as o,c as Y,j as u}from"./index-CehqyWGD.js";import{P as _}from"./PlatformToolLayout-C8VnRpmc.js";const C=[{code:"213",labelKey:"platform.yandex.regions.213",countries:["RU"]},{code:"2",labelKey:"platform.yandex.regions.2",countries:["RU"]},{code:"187",labelKey:"platform.yandex.regions.187",countries:["UA"]},{code:"157",labelKey:"platform.yandex.regions.157",countries:["BY"]},{code:"163",labelKey:"platform.yandex.regions.163",countries:["KZ"]},{code:"225",labelKey:"platform.yandex.regions.225",countries:["RU"]},{code:"0",labelKey:"platform.yandex.regions.0",countries:[]}],j=p=>{const y=(p||"").toUpperCase(),f=C.find(a=>a.countries.includes(y));return f?f.code:"225"},M=p=>{const{keyword:y,setKeyword:f,searchLanguage:a,country:g,ui:b,locationControls:k,onGlobalSearch:v,globalLoading:L}=p,t=y??"",[n,w]=o.useState(()=>j(g)),[U,m]=o.useState([]),[F,R]=o.useState(!1),[A,s]=o.useState(null),l=o.useRef(!1),e=o.useMemo(()=>Y(b),[b]),S=o.useCallback(r=>{switch(r){case"213":return e("platform.yandex.regions.213");case"2":return e("platform.yandex.regions.2");case"187":return e("platform.yandex.regions.187");case"157":return e("platform.yandex.regions.157");case"163":return e("platform.yandex.regions.163");case"225":return e("platform.yandex.regions.225");case"0":default:return e("platform.yandex.regions.0")}},[e]),N=o.useMemo(()=>C.map(r=>({code:r.code,label:S(r.code)})),[S]);o.useEffect(()=>{w(j(g))},[g]);const c=o.useCallback(async r=>{const K=r.trim();if(!K){m([]),s(null);return}R(!0),s(null);try{const i=new URLSearchParams({q:K,lr:n});a&&i.set("lang",a.toLowerCase());const d=await fetch(`/api/platforms/yandex?${i.toString()}`);if(!d.ok){const h=await d.json().catch(()=>null);throw new Error(h?.error||e("platform.yandex.errors.fetch"))}const x=await d.json(),E=(Array.isArray(x?.suggestions)?x.suggestions:[]).map((h,T)=>({title:h,subtitle:e("platform.yandex.results.subtitle",{region:x?.region||n||"all"}),metric:e("platform.yandex.results.rank",{rank:T+1})}));m(E),E.length===0&&s(e("platform.yandex.errors.noneFound"))}catch(i){const d=i instanceof Error?i.message:e("platform.yandex.errors.generic");s(d),m([])}finally{R(!1)}},[n,a,e]);o.useEffect(()=>{if(!t.trim()){m([]),s(null),l.current=!1;return}l.current||(l.current=!0,c(t))},[t,c]),o.useEffect(()=>{t.trim()&&l.current&&c(t)},[n,a,t,c]);const P=u.jsx("div",{className:"platform-tool__filters",children:u.jsxs("label",{htmlFor:"yandex-region",children:[e("platform.yandex.filters.region"),u.jsx("select",{id:"yandex-region",value:n,onChange:r=>{w(r.target.value),l.current=!1},children:N.map(r=>u.jsx("option",{value:r.code,children:r.label},r.code))})]})});return u.jsx(_,{platformName:e("platform.yandex.meta.name"),keyword:t,onKeywordChange:f,onSearch:c,description:e("platform.yandex.description"),extraFilters:P,results:U,placeholder:e("platform.yandex.placeholder"),loading:F,error:A,emptyState:e("platform.yandex.emptyState"),controls:k,onGlobalSearch:v,globalLoading:L,translate:e})};export{M as default};
