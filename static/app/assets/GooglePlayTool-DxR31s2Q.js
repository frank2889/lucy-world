import{r as l,c as v,j as u}from"./index-DpPXBorx.js";import{P as T}from"./PlatformToolLayout-CR1r2XCf.js";const D=["US","GB","CA","AU","DE","FR","ES","IT","NL","BR","IN"],N=p=>{const y=(p||"").toUpperCase();return D.find(s=>s===y)??"US"},q=p=>{const{keyword:y,setKeyword:S,searchLanguage:s,country:d,ui:b,uiFallback:E,locationControls:U,onGlobalSearch:A,globalLoading:x,getCountryName:e}=p,r=y??"",[a,R]=l.useState(()=>N(d)),[j,f]=l.useState([]),[F,w]=l.useState(!1),[G,n]=l.useState(null),g=l.useRef(!1),o=l.useMemo(()=>v(b,E),[b,E]),I=l.useMemo(()=>[{code:"US",label:e?.("US")??o("platform.googlePlay.regions.US")},{code:"GB",label:e?.("GB")??o("platform.googlePlay.regions.GB")},{code:"CA",label:e?.("CA")??o("platform.googlePlay.regions.CA")},{code:"AU",label:e?.("AU")??o("platform.googlePlay.regions.AU")},{code:"DE",label:e?.("DE")??o("platform.googlePlay.regions.DE")},{code:"FR",label:e?.("FR")??o("platform.googlePlay.regions.FR")},{code:"ES",label:e?.("ES")??o("platform.googlePlay.regions.ES")},{code:"IT",label:e?.("IT")??o("platform.googlePlay.regions.IT")},{code:"NL",label:e?.("NL")??o("platform.googlePlay.regions.NL")},{code:"BR",label:e?.("BR")??o("platform.googlePlay.regions.BR")},{code:"IN",label:e?.("IN")??o("platform.googlePlay.regions.IN")}],[e,o]);l.useEffect(()=>{R(N(d))},[d]);const c=l.useCallback(async t=>{const C=t.trim();if(!C){f([]),n(null);return}w(!0),n(null);try{const m=new URLSearchParams({q:C,country:a,lang:(s||"").toLowerCase(),limit:"10"}),i=await fetch(`/api/platforms/googleplay?${m.toString()}`);if(!i.ok){const h=await i.json().catch(()=>null);throw new Error(h?.error||o("platform.googlePlay.errors.unknownResponse"))}const P=await i.json(),L=(Array.isArray(P?.suggestions)?P.suggestions:[]).map((h,B)=>({title:h,subtitle:o("platform.googlePlay.results.subtitle",{country:(P?.country?.toUpperCase()||a)??a}),metric:o("platform.googlePlay.results.rank",{rank:B+1})}));f(L),L.length===0&&n(o("platform.googlePlay.errors.noneFound"))}catch(m){const i=m instanceof Error?m.message:o("platform.googlePlay.errors.generic");n(i),f([])}finally{w(!1)}},[a,s,o]);l.useEffect(()=>{if(!r.trim()){f([]),n(null),g.current=!1;return}g.current||(g.current=!0,c(r))},[r,c]),l.useEffect(()=>{r.trim()&&g.current&&c(r)},[a,s,r,c]);const k=u.jsx("div",{className:"platform-tool__filters",children:u.jsxs("label",{htmlFor:"google-play-region",children:[o("platform.googlePlay.filters.region"),u.jsx("select",{id:"google-play-region",value:a,onChange:t=>{R(t.target.value),g.current=!1},children:I.map(t=>u.jsx("option",{value:t.code,children:t.label},t.code))})]})});return u.jsx(T,{platformName:o("platform.googlePlay.meta.name"),keyword:r,onKeywordChange:S,onSearch:c,description:o("platform.googlePlay.description"),extraFilters:k,results:j,placeholder:o("platform.googlePlay.form.placeholder"),loading:F,error:G,emptyState:o("platform.googlePlay.emptyState"),controls:U,onGlobalSearch:A,globalLoading:x,translate:o})};export{q as default};
