import{r as a,c as _,j as u}from"./index-DpPXBorx.js";import{P as q}from"./PlatformToolLayout-CR1r2XCf.js";const C=[{code:"213",labelKey:"platform.yandex.regions.213",countries:["RU"]},{code:"2",labelKey:"platform.yandex.regions.2",countries:["RU"]},{code:"187",labelKey:"platform.yandex.regions.187",countries:["UA"]},{code:"157",labelKey:"platform.yandex.regions.157",countries:["BY"]},{code:"163",labelKey:"platform.yandex.regions.163",countries:["KZ"]},{code:"225",labelKey:"platform.yandex.regions.225",countries:["RU"]},{code:"0",labelKey:"platform.yandex.regions.0",countries:[]}],k=p=>{const y=(p||"").toUpperCase(),f=C.find(t=>t.countries.includes(y));return f?f.code:"225"},B=p=>{const{keyword:y,setKeyword:f,searchLanguage:t,country:g,ui:b,uiFallback:w,locationControls:v,onGlobalSearch:L,globalLoading:F}=p,o=y??"",[n,R]=a.useState(()=>k(g)),[U,m]=a.useState([]),[A,S]=a.useState(!1),[N,s]=a.useState(null),l=a.useRef(!1),e=a.useMemo(()=>_(b,w),[b,w]),K=a.useCallback(r=>{switch(r){case"213":return e("platform.yandex.regions.213");case"2":return e("platform.yandex.regions.2");case"187":return e("platform.yandex.regions.187");case"157":return e("platform.yandex.regions.157");case"163":return e("platform.yandex.regions.163");case"225":return e("platform.yandex.regions.225");case"0":default:return e("platform.yandex.regions.0")}},[e]),P=a.useMemo(()=>C.map(r=>({code:r.code,label:K(r.code)})),[K]);a.useEffect(()=>{R(k(g))},[g]);const c=a.useCallback(async r=>{const E=r.trim();if(!E){m([]),s(null);return}S(!0),s(null);try{const i=new URLSearchParams({q:E,lr:n});t&&i.set("lang",t.toLowerCase());const d=await fetch(`/api/platforms/yandex?${i.toString()}`);if(!d.ok){const h=await d.json().catch(()=>null);throw new Error(h?.error||e("platform.yandex.errors.fetch"))}const x=await d.json(),j=(Array.isArray(x?.suggestions)?x.suggestions:[]).map((h,Y)=>({title:h,subtitle:e("platform.yandex.results.subtitle",{region:x?.region||n||"all"}),metric:e("platform.yandex.results.rank",{rank:Y+1})}));m(j),j.length===0&&s(e("platform.yandex.errors.noneFound"))}catch(i){const d=i instanceof Error?i.message:e("platform.yandex.errors.generic");s(d),m([])}finally{S(!1)}},[n,t,e]);a.useEffect(()=>{if(!o.trim()){m([]),s(null),l.current=!1;return}l.current||(l.current=!0,c(o))},[o,c]),a.useEffect(()=>{o.trim()&&l.current&&c(o)},[n,t,o,c]);const T=u.jsx("div",{className:"platform-tool__filters",children:u.jsxs("label",{htmlFor:"yandex-region",children:[e("platform.yandex.filters.region"),u.jsx("select",{id:"yandex-region",value:n,onChange:r=>{R(r.target.value),l.current=!1},children:P.map(r=>u.jsx("option",{value:r.code,children:r.label},r.code))})]})});return u.jsx(q,{platformName:e("platform.yandex.meta.name"),keyword:o,onKeywordChange:f,onSearch:c,description:e("platform.yandex.description"),extraFilters:T,results:U,placeholder:e("platform.yandex.placeholder"),loading:A,error:N,emptyState:e("platform.yandex.emptyState"),controls:v,onGlobalSearch:L,globalLoading:F,translate:e})};export{B as default};
