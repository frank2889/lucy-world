import{r as l,c as k,j as f}from"./index-BqAUk1Ix.js";import{P as v}from"./PlatformToolLayout-BVIQfinc.js";const T=["US","GB","CA","AU","DE","FR","ES","IT","NL","BR","IN"],L=p=>{const y=(p||"").toUpperCase();return T.find(s=>s===y)??"US"},K=p=>{const{keyword:y,setKeyword:S,searchLanguage:s,country:d,ui:b,locationControls:N,onGlobalSearch:U,globalLoading:A,getCountryName:e}=p,r=y??"",[a,E]=l.useState(()=>L(d)),[x,u]=l.useState([]),[j,R]=l.useState(!1),[G,n]=l.useState(null),g=l.useRef(!1),o=l.useMemo(()=>k(b),[b]),I=l.useMemo(()=>[{code:"US",label:e?.("US")??o("platform.googlePlay.regions.US")},{code:"GB",label:e?.("GB")??o("platform.googlePlay.regions.GB")},{code:"CA",label:e?.("CA")??o("platform.googlePlay.regions.CA")},{code:"AU",label:e?.("AU")??o("platform.googlePlay.regions.AU")},{code:"DE",label:e?.("DE")??o("platform.googlePlay.regions.DE")},{code:"FR",label:e?.("FR")??o("platform.googlePlay.regions.FR")},{code:"ES",label:e?.("ES")??o("platform.googlePlay.regions.ES")},{code:"IT",label:e?.("IT")??o("platform.googlePlay.regions.IT")},{code:"NL",label:e?.("NL")??o("platform.googlePlay.regions.NL")},{code:"BR",label:e?.("BR")??o("platform.googlePlay.regions.BR")},{code:"IN",label:e?.("IN")??o("platform.googlePlay.regions.IN")}],[e,o]);l.useEffect(()=>{E(L(d))},[d]);const c=l.useCallback(async t=>{const w=t.trim();if(!w){u([]),n(null);return}R(!0),n(null);try{const m=new URLSearchParams({q:w,country:a,lang:(s||"").toLowerCase(),limit:"10"}),i=await fetch(`/api/platforms/googleplay?${m.toString()}`);if(!i.ok){const h=await i.json().catch(()=>null);throw new Error(h?.error||o("platform.googlePlay.errors.unknownResponse"))}const P=await i.json(),C=(Array.isArray(P?.suggestions)?P.suggestions:[]).map((h,F)=>({title:h,subtitle:o("platform.googlePlay.results.subtitle",{country:(P?.country?.toUpperCase()||a)??a}),metric:o("platform.googlePlay.results.rank",{rank:F+1})}));u(C),C.length===0&&n(o("platform.googlePlay.errors.noneFound"))}catch(m){const i=m instanceof Error?m.message:o("platform.googlePlay.errors.generic");n(i),u([])}finally{R(!1)}},[a,s,o]);l.useEffect(()=>{if(!r.trim()){u([]),n(null),g.current=!1;return}g.current||(g.current=!0,c(r))},[r,c]),l.useEffect(()=>{r.trim()&&g.current&&c(r)},[a,s,r,c]);const B=f.jsx("div",{className:"platform-tool__filters",children:f.jsxs("label",{htmlFor:"google-play-region",children:[o("platform.googlePlay.filters.region"),f.jsx("select",{id:"google-play-region",value:a,onChange:t=>{E(t.target.value),g.current=!1},children:I.map(t=>f.jsx("option",{value:t.code,children:t.label},t.code))})]})});return f.jsx(v,{platformName:o("platform.googlePlay.meta.name"),keyword:r,onKeywordChange:S,onSearch:c,description:o("platform.googlePlay.description"),extraFilters:B,results:x,placeholder:o("platform.googlePlay.form.placeholder"),loading:j,error:G,emptyState:o("platform.googlePlay.emptyState"),controls:N,onGlobalSearch:U,globalLoading:A,translate:o})};export{K as default};
