import{r as e,c as R,j as m}from"./index-C6i-a171.js";import{P as _}from"./PlatformToolLayout-Z7gxyS7o.js";const h={opensearch:"OpenSearch",toolbar:"Toolbar",mobile:"Mobile"},O=v=>{const{keyword:L,setKeyword:x,searchLanguage:d,ui:b,uiFallback:g,locationControls:j,onGlobalSearch:E,globalLoading:C}=v,r=L??"",[n,k]=e.useState("opensearch"),[F,p]=e.useState([]),[A,q]=e.useState(!1),[T,l]=e.useState(null),s=e.useRef(!1),t=e.useMemo(()=>R(b,g),[b,g]),y=e.useMemo(()=>{const a=t("platform.qwant.client.opensearch"),i=t("platform.qwant.client.toolbar"),o=t("platform.qwant.client.mobile");return[{value:"opensearch",label:a==="platform.qwant.client.opensearch"?h.opensearch:a},{value:"toolbar",label:i==="platform.qwant.client.toolbar"?h.toolbar:i},{value:"mobile",label:o==="platform.qwant.client.mobile"?h.mobile:o}]},[t]),c=e.useCallback(async a=>{const i=a.trim();if(!i){p([]),l(null);return}q(!0),l(null);try{const o=new URLSearchParams({q:i,lang:(d||"").toLowerCase(),client:n}),u=await fetch(`/api/platforms/qwant?${o.toString()}`);if(!u.ok){const w=await u.json().catch(()=>null);throw new Error(w?.error||t("platform.qwant.errors.fetch"))}const f=await u.json(),S=(Array.isArray(f?.suggestions)?f.suggestions:[]).map((w,M)=>({title:w,subtitle:t("platform.qwant.results.subtitle",{client:f?.metadata?.client||n}),metric:t("platform.qwant.results.rank",{rank:M+1})}));p(S),S.length===0&&l(t("platform.qwant.errors.noneFound"))}catch(o){const u=o instanceof Error?o.message:t("platform.qwant.errors.generic");l(u),p([])}finally{q(!1)}},[n,d,t]);e.useEffect(()=>{if(!r.trim()){p([]),l(null),s.current=!1;return}s.current||(s.current=!0,c(r))},[r,c]),e.useEffect(()=>{r.trim()&&s.current&&c(r)},[n,r,c]);const K=e.useMemo(()=>m.jsx("div",{className:"platform-tool__filters",children:m.jsxs("label",{htmlFor:"qwant-client",children:[t("platform.qwant.filters.client"),m.jsx("select",{id:"qwant-client",value:n,onChange:a=>{k(a.target.value),s.current=!1},children:y.map(a=>m.jsx("option",{value:a.value,children:a.label},a.value))})]})}),[n,y,t]);return m.jsx(_,{platformName:t("platform.qwant.meta.name"),keyword:r,onKeywordChange:x,onSearch:c,description:t("platform.qwant.description"),extraFilters:K,results:F,placeholder:t("platform.qwant.placeholder"),loading:A,error:T,emptyState:t("platform.qwant.emptyState"),controls:j,onGlobalSearch:E,globalLoading:C,translate:t})};export{O as default};
