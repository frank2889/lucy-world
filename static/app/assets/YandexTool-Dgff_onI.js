import{r as o,c as P,j as f}from"./index-B_bW3Ap_.js";import{P as q}from"./PlatformToolLayout-D8L_NNlt.js";const j=[{code:"213",label:"Россия — Москва",countries:["RU"]},{code:"2",label:"Россия — Санкт-Петербург",countries:["RU"]},{code:"187",label:"Україна",countries:["UA"]},{code:"157",label:"Беларусь",countries:["BY"]},{code:"163",label:"Қазақстан",countries:["KZ"]},{code:"225",label:"Россия — вся страна",countries:["RU"]},{code:"0",label:"Все регионы",countries:[]}],k=p=>{const y=(p||"").toUpperCase(),m=j.find(n=>n.countries.includes(y));return m?m.code:"225"},z=p=>{const{keyword:y,setKeyword:m,searchLanguage:n,country:h,ui:w,locationControls:v,onGlobalSearch:U,globalLoading:Y}=p,a=y??"",[s,R]=o.useState(()=>k(h)),[C,g]=o.useState([]),[L,S]=o.useState(!1),[A,l]=o.useState(null),c=o.useRef(!1),e=o.useMemo(()=>P(w),[w]),F=o.useMemo(()=>{const r=new Map;for(const t of j)r.has(t.code)||r.set(t.code,{code:t.code,label:e(`platform.yandex.regions.${t.code}`,t.label)});return Array.from(r.values())},[e]);o.useEffect(()=>{R(k(h))},[h]);const i=o.useCallback(async r=>{const t=r.trim();if(!t){g([]),l(null);return}S(!0),l(null);try{const u=new URLSearchParams({q:t,lr:s});n&&u.set("lang",n.toLowerCase());const d=await fetch(`/api/platforms/yandex?${u.toString()}`);if(!d.ok){const b=await d.json().catch(()=>null);throw new Error(b?.error||e("platform.yandex.errors.fetch","Unable to fetch Yandex suggestions"))}const x=await d.json(),E=(Array.isArray(x?.suggestions)?x.suggestions:[]).map((b,K)=>({title:b,subtitle:e("platform.yandex.results.subtitle","Query ({{region}})",{region:x?.region||s||"all"}),metric:e("platform.yandex.results.rank","Popularity #{{rank}}",{rank:K+1})}));g(E),E.length===0&&l(e("platform.yandex.errors.noneFound","No Yandex suggestions found for this keyword."))}catch(u){const d=u instanceof Error?u.message:e("platform.yandex.errors.generic","Unknown error");l(d),g([])}finally{S(!1)}},[s,n,e]);o.useEffect(()=>{if(!a.trim()){g([]),l(null),c.current=!1;return}c.current||(c.current=!0,i(a))},[a,i]),o.useEffect(()=>{a.trim()&&c.current&&i(a)},[s,n,a,i]);const N=f.jsx("div",{className:"platform-tool__filters",children:f.jsxs("label",{htmlFor:"yandex-region",children:[e("platform.yandex.filters.region","Region"),f.jsx("select",{id:"yandex-region",value:s,onChange:r=>{R(r.target.value),c.current=!1},children:F.map(r=>f.jsx("option",{value:r.code,children:r.label},r.code))})]})});return f.jsx(q,{platformName:e("platform.yandex.meta.name","Yandex"),keyword:a,onKeywordChange:m,onSearch:i,description:e("platform.yandex.description","Local search terms for the Yandex ecosystem."),extraFilters:N,results:C,placeholder:e("platform.yandex.placeholder","Which Russian search term are you researching?"),loading:L,error:A,emptyState:e("platform.yandex.emptyState","Enter a keyword for Yandex insights."),controls:v,onGlobalSearch:U,globalLoading:Y,translate:e})};export{z as default};
