import{r as t,A as R,c as v,j as s}from"./index-DNWYoPKs.js";import{P as K}from"./PlatformToolLayout-YowsWSnA.js";const p=R,N=n=>{const{keyword:E,setKeyword:b,country:w,ui:y}=n,r=E??"",[d,x]=t.useState(()=>{const a=(w??"").toUpperCase();return p.some(f=>f.code===a)?a:"US"}),[A,l]=t.useState([]),[j,z]=t.useState(!1),[C,c]=t.useState(null),m=t.useRef(!1),e=t.useMemo(()=>v(y),[y]),i=t.useMemo(()=>p.find(a=>a.code===d)??p[0],[d]),g=t.useCallback(async a=>{const f=a.trim();if(!f){l([]);return}z(!0),c(null);try{const u=new URLSearchParams({q:f,country:i.code,alias:"aps"}),o=await fetch(`/api/platforms/amazon?${u.toString()}`);if(!o.ok){const h=await o.json().catch(()=>null);throw new Error(h?.error||e("platform.amazon.error.fetch"))}const S=await o.json(),k=(Array.isArray(S?.suggestions)?S.suggestions:[]).map((h,M)=>({title:h,subtitle:e("platform.amazon.subtitle",{marketplace:i.label}),metric:e("platform.amazon.metric.rank",{rank:M+1})}));l(k),k.length===0&&c(e("platform.amazon.error.none"))}catch(u){const o=u instanceof Error?u.message:e("platform.amazon.error.generic");c(o),l([])}finally{z(!1)}},[i.code,i.label,e]);t.useEffect(()=>{m.current||r.trim()&&(m.current=!0,g(r))},[r,g]),t.useEffect(()=>{r.trim()||(l([]),c(null),m.current=!1)},[r]);const L=s.jsx("div",{className:"platform-tool__filters",children:s.jsxs("label",{htmlFor:"amazon-marketplace",children:[e("platform.amazon.filters.marketplace"),s.jsx("select",{id:"amazon-marketplace",value:d,onChange:a=>{x(a.target.value),m.current=!1},children:p.map(a=>s.jsx("option",{value:a.code,children:a.label},a.code))})]})});return s.jsx(K,{platformName:e("platform.amazon.meta.name"),keyword:r,onKeywordChange:b,onSearch:g,description:e("platform.amazon.description"),extraFilters:L,results:A,placeholder:e("platform.amazon.placeholder"),loading:j,error:C,emptyState:e("platform.amazon.empty"),controls:n.locationControls,onGlobalSearch:n.onGlobalSearch,globalLoading:n.globalLoading,translate:e})};export{N as default};
