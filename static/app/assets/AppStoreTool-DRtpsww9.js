import{r,c as B,j as u}from"./index-CaUPr3nC.js";import{P as G}from"./PlatformToolLayout-BYh0qkdb.js";const A=[{code:"US",label:"United States"},{code:"GB",label:"United Kingdom"},{code:"CA",label:"Canada"},{code:"AU",label:"Australia"},{code:"DE",label:"Germany"},{code:"FR",label:"France"},{code:"ES",label:"Spain"},{code:"IT",label:"Italy"},{code:"NL",label:"Netherlands"},{code:"BE",label:"Belgium"},{code:"JP",label:"Japan"}],x=s=>{const y=(s||"").toUpperCase();return A.find(n=>n.code===y)?.code??"US"},z=s=>{const{keyword:y,setKeyword:h,country:n,ui:S}=s,o=y??"",[d,b]=r.useState(()=>x(n)),[U,f]=r.useState([]),[j,w]=r.useState(!1),[R,l]=r.useState(null),c=r.useRef(!1),t=r.useMemo(()=>B(S),[S]),v=r.useMemo(()=>A,[]);r.useEffect(()=>{b(x(n))},[n]);const i=r.useCallback(async a=>{const g=a.trim();if(!g){f([]),l(null);return}w(!0),l(null);try{const m=new URLSearchParams({q:g,country:d,limit:"15"}),p=await fetch(`/api/platforms/appstore?${m.toString()}`);if(!p.ok){const e=await p.json().catch(()=>null);throw new Error(e?.error||t("platform.appstore.error.fetch","Unable to fetch App Store data"))}const E=await p.json(),k=(Array.isArray(E?.results)?E.results:[]).map((e,P)=>{const N=e.trackName||g,F=[e.artistName,e.primaryGenreName].filter(Boolean),L=typeof e.averageUserRating=="number"?`${e.averageUserRating.toFixed(1)}★${e.userRatingCount?` (${e.userRatingCount.toLocaleString()})`:""}`:null,T=e.formattedPrice||(typeof e.price=="number"?e.price===0?t("platform.appstore.price.free","Free"):`${e.price} ${e.currency||""}`:null),$=[L,T].filter(Boolean);return{title:N,subtitle:F.join(" • ")||void 0,metric:$.join(" • ")||t("platform.appstore.metric.rank","Popularity #{{rank}}",{rank:P+1})}});f(k),k.length===0&&l(t("platform.appstore.error.none","No App Store suggestions found for this keyword."))}catch(m){const p=m instanceof Error?m.message:t("platform.appstore.error.generic","Unknown error");l(p),f([])}finally{w(!1)}},[d,t]);r.useEffect(()=>{if(!o.trim()){f([]),l(null),c.current=!1;return}c.current||(c.current=!0,i(o))},[o,i]),r.useEffect(()=>{o.trim()&&c.current&&i(o)},[d,o,i]);const C=u.jsx("div",{className:"platform-tool__filters",children:u.jsxs("label",{htmlFor:"appstore-country",children:[t("platform.appstore.filters.store","Store"),u.jsx("select",{id:"appstore-country",value:d,onChange:a=>{b(a.target.value),c.current=!1},children:v.map(a=>u.jsx("option",{value:a.code,children:a.label},a.code))})]})});return u.jsx(G,{platformName:t("platform.appstore.meta.name","App Store"),keyword:o,onKeywordChange:h,onSearch:i,description:t("platform.appstore.description","App Store Optimization insights for iOS apps."),extraFilters:C,results:U,placeholder:t("platform.appstore.placeholder","Which app keyword are you exploring?"),loading:j,error:R,emptyState:t("platform.appstore.empty","Enter a keyword to see App Store suggestions."),controls:s.locationControls,onGlobalSearch:s.onGlobalSearch,globalLoading:s.globalLoading,translate:t})};export{z as default};
