import{r as t,c as F,j as y}from"./index-C6i-a171.js";import{P as L}from"./PlatformToolLayout-Z7gxyS7o.js";const f=[{country:"US",siteId:"0",label:"United States (eBay.com)"},{country:"CA",siteId:"2",label:"Canada (eBay.ca)"},{country:"GB",siteId:"3",label:"United Kingdom (eBay.co.uk)"},{country:"AU",siteId:"15",label:"Australia (eBay.com.au)"},{country:"AT",siteId:"16",label:"Austria (eBay.at)"},{country:"FR",siteId:"71",label:"France (eBay.fr)"},{country:"DE",siteId:"77",label:"Germany (eBay.de)"},{country:"BE",siteId:"23",label:"Belgium (eBay.be)"},{country:"IT",siteId:"101",label:"Italy (eBay.it)"},{country:"NL",siteId:"146",label:"Netherlands (eBay.nl)"},{country:"ES",siteId:"186",label:"Spain (eBay.es)"}],R="0",j=s=>{const b=(s||"").toUpperCase();return f.find(r=>r.country===b)?.siteId??R},K=s=>{const{keyword:b,setKeyword:h,country:r,ui:g,uiFallback:I}=s,o=b??"",[l,S]=t.useState(()=>j(r)),[A,d]=t.useState([]),[C,E]=t.useState(!1),[T,n]=t.useState(null),c=t.useRef(!1),e=t.useMemo(()=>F(g,I),[g,I]),B=t.useMemo(()=>f.find(a=>a.siteId===l)??f[0],[l]);t.useEffect(()=>{S(j(r))},[r]);const i=t.useCallback(async a=>{const w=a.trim();if(!w){d([]),n(null);return}E(!0),n(null);try{const m=new URLSearchParams({q:w,siteId:l,country:(r||"").toUpperCase(),max:"10"}),u=await fetch(`/api/platforms/ebay?${m.toString()}`);if(!u.ok){const p=await u.json().catch(()=>null);throw new Error(p?.error||e("platform.ebay.error.fetch"))}const x=await u.json(),k=(Array.isArray(x?.suggestions)?x.suggestions:[]).map((p,v)=>({title:p,subtitle:e("platform.ebay.subtitle",{marketplace:B.label}),metric:e("platform.ebay.metric.rank",{rank:v+1})}));d(k),k.length===0&&n(e("platform.ebay.error.none"))}catch(m){const u=m instanceof Error?m.message:e("platform.ebay.error.generic");n(u),d([])}finally{E(!1)}},[l,r,B.label,e]);t.useEffect(()=>{if(!o.trim()){d([]),n(null),c.current=!1;return}c.current||(c.current=!0,i(o))},[o,i]),t.useEffect(()=>{o.trim()&&c.current&&i(o)},[l,o,i]);const U=y.jsx("div",{className:"platform-tool__filters",children:y.jsxs("label",{htmlFor:"ebay-site",children:[e("platform.ebay.filters.marketplace"),y.jsx("select",{id:"ebay-site",value:l,onChange:a=>{S(a.target.value),c.current=!1},children:f.map(a=>y.jsx("option",{value:a.siteId,children:a.label},a.siteId))})]})});return y.jsx(L,{platformName:e("platform.ebay.meta.name"),keyword:o,onKeywordChange:h,onSearch:i,description:e("platform.ebay.description"),extraFilters:U,results:A,placeholder:e("platform.ebay.placeholder"),loading:C,error:T,emptyState:e("platform.ebay.empty"),controls:s.locationControls,onGlobalSearch:s.onGlobalSearch,globalLoading:s.globalLoading,translate:e})};export{K as default};
