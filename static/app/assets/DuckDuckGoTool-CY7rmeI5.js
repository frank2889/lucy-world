import{r as o,c as D,j as p}from"./index-DpPXBorx.js";import{P as O}from"./PlatformToolLayout-CR1r2XCf.js";const R=[{code:"wt-wt"},{code:"us-en"},{code:"uk-en"},{code:"nl-nl"},{code:"de-de"},{code:"fr-fr"},{code:"es-es"},{code:"it-it"},{code:"jp-jp"},{code:"in-en"},{code:"br-pt"}],_=new Set(R.map(c=>c.code.toLowerCase())),$="wt-wt",x=(c,b)=>{const a=(c||"").split("-")[0].toLowerCase(),n=(b||"").split("-")[0].toLowerCase();if(a&&n){const r=`${n}-${a}`;if(_.has(r))return r}if(a)for(const r of R){const u=r.code.toLowerCase();if(u.endsWith(`-${a}`)||u.startsWith(`${a}-`))return u}return $},I=c=>{const{keyword:b,setKeyword:a,searchLanguage:n,country:r,ui:u,uiFallback:y}=c,s=b??"",[d,j]=o.useState(()=>x(n,r)),[v,m]=o.useState([]),[G,S]=o.useState(!1),[F,i]=o.useState(null),g=o.useRef(!1),e=o.useMemo(()=>D(u,y),[u,y]),C=o.useMemo(()=>[{code:"wt-wt",label:e("platform.duckduckgo.region.wt-wt")},{code:"us-en",label:e("platform.duckduckgo.region.us-en")},{code:"uk-en",label:e("platform.duckduckgo.region.uk-en")},{code:"nl-nl",label:e("platform.duckduckgo.region.nl-nl")},{code:"de-de",label:e("platform.duckduckgo.region.de-de")},{code:"fr-fr",label:e("platform.duckduckgo.region.fr-fr")},{code:"es-es",label:e("platform.duckduckgo.region.es-es")},{code:"it-it",label:e("platform.duckduckgo.region.it-it")},{code:"jp-jp",label:e("platform.duckduckgo.region.jp-jp")},{code:"in-en",label:e("platform.duckduckgo.region.in-en")},{code:"br-pt",label:e("platform.duckduckgo.region.br-pt")}],[e]);o.useEffect(()=>{j(x(n,r))},[n,r]);const f=o.useCallback(async l=>{const L=l.trim();if(!L){m([]),i(null);return}S(!0),i(null);try{const h=new URLSearchParams({q:L,kl:d,lang:(n||"").toLowerCase(),country:(r||"").toUpperCase()}),k=await fetch(`/api/platforms/duckduckgo?${h.toString()}`);if(!k.ok){const t=await k.json().catch(()=>null);throw new Error(t?.error||e("platform.duckduckgo.error.fetch"))}const w=await k.json(),E=(Array.isArray(w?.suggestions)?w.suggestions:[]).filter(t=>typeof t?.phrase=="string"&&t.phrase.trim().length>0).map((t,N)=>({title:t.phrase,subtitle:t.snippet||e("platform.duckduckgo.subtitle",{region:w?.kl||d}),metric:typeof t.score=="number"&&Number.isFinite(t.score)?e("platform.duckduckgo.metric.score",{score:t.score}):e("platform.duckduckgo.metric.rank",{rank:N+1})}));m(E),E.length===0&&i(e("platform.duckduckgo.error.none"))}catch(h){const k=h instanceof Error?h.message:e("platform.duckduckgo.error.generic");i(k),m([])}finally{S(!1)}},[d,n,r,e]);o.useEffect(()=>{if(!s.trim()){m([]),i(null),g.current=!1;return}g.current||(g.current=!0,f(s))},[s,f]),o.useEffect(()=>{s.trim()&&g.current&&f(s)},[d,s,f]);const K=o.useMemo(()=>p.jsx("div",{className:"platform-tool__filters",children:p.jsxs("label",{htmlFor:"duckduckgo-region",children:[e("platform.duckduckgo.filters.region"),p.jsx("select",{id:"duckduckgo-region",value:d,onChange:l=>{j(l.target.value),g.current=!1},children:C.map(l=>p.jsx("option",{value:l.code,children:l.label},l.code))})]})}),[d,C,e]);return p.jsx(O,{platformName:e("platform.duckduckgo.meta.name"),keyword:s,onKeywordChange:a,onSearch:f,description:e("platform.duckduckgo.description"),extraFilters:K,results:v,placeholder:e("platform.duckduckgo.placeholder"),loading:G,error:F,emptyState:e("platform.duckduckgo.empty"),controls:c.locationControls,onGlobalSearch:c.onGlobalSearch,globalLoading:c.globalLoading,translate:e})};export{I as default};
