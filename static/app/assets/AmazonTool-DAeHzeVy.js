import{r,A as P,c as R,j as s}from"./index-C-suCUV6.js";import{P as v}from"./PlatformToolLayout-Dv7YUvVj.js";const d=P,U=n=>{const{keyword:A,setKeyword:S,country:E,ui:y}=n,t=A??"",[p,b]=r.useState(()=>{const a=(E??"").toUpperCase();return d.some(u=>u.code===a)?a:"US"}),[x,l]=r.useState([]),[j,k]=r.useState(!1),[M,c]=r.useState(null),i=r.useRef(!1),e=r.useMemo(()=>R(y),[y]),m=r.useMemo(()=>d.find(a=>a.code===p)??d[0],[p]),g=r.useCallback(async a=>{const u=a.trim();if(!u){l([]);return}k(!0),c(null);try{const f=new URLSearchParams({q:u,country:m.code,alias:"aps"}),o=await fetch(`/api/platforms/amazon?${f.toString()}`);if(!o.ok){const h=await o.json().catch(()=>null);throw new Error(h?.error||e("platform.amazon.error.fetch","Amazon data request failed"))}const z=await o.json(),w=(Array.isArray(z?.suggestions)?z.suggestions:[]).map((h,L)=>({title:h,subtitle:e("platform.amazon.subtitle","Suggestion for {{marketplace}}",{marketplace:m.label}),metric:e("platform.amazon.metric.rank","Popularity #{{rank}}",{rank:L+1})}));l(w),w.length===0&&c(e("platform.amazon.error.none","No Amazon suggestions found for this keyword."))}catch(f){const o=f instanceof Error?f.message:e("platform.amazon.error.generic","Unknown error");c(o),l([])}finally{k(!1)}},[m.code,m.label,e]);r.useEffect(()=>{i.current||t.trim()&&(i.current=!0,g(t))},[t,g]),r.useEffect(()=>{t.trim()||(l([]),c(null),i.current=!1)},[t]);const C=s.jsx("div",{className:"platform-tool__filters",children:s.jsxs("label",{htmlFor:"amazon-marketplace",children:[e("platform.amazon.filters.marketplace","Marketplace"),s.jsx("select",{id:"amazon-marketplace",value:p,onChange:a=>{b(a.target.value),i.current=!1},children:d.map(a=>s.jsx("option",{value:a.code,children:a.label},a.code))})]})});return s.jsx(v,{platformName:e("platform.amazon.meta.name","Amazon"),keyword:t,onKeywordChange:S,onSearch:g,description:e("platform.amazon.description","Product keyword discovery and listing insights for Amazon."),extraFilters:C,results:x,placeholder:e("platform.amazon.placeholder","Which products do you sell?"),loading:j,error:M,emptyState:e("platform.amazon.empty","Enter a keyword to see Amazon insights."),controls:n.locationControls,onGlobalSearch:n.onGlobalSearch,globalLoading:n.globalLoading,translate:e})};export{U as default};
