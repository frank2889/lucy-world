import{r as t,c as R,j as g}from"./index-CNrdwjJ5.js";import{P as U}from"./PlatformToolLayout-Bh7vTboc.js";const k=[{code:"en-US",label:"United States (English)"},{code:"en-GB",label:"United Kingdom (English)"},{code:"en-AU",label:"Australia (English)"},{code:"en-CA",label:"Canada (English)"},{code:"fr-FR",label:"France (Français)"},{code:"fr-CA",label:"Canada (Français)"},{code:"de-DE",label:"Deutschland (Deutsch)"},{code:"es-ES",label:"España (Español)"},{code:"es-MX",label:"México (Español)"},{code:"nl-NL",label:"Nederland (Nederlands)"},{code:"it-IT",label:"Italia (Italiano)"},{code:"pt-BR",label:"Brasil (Português)"},{code:"ja-JP",label:"日本 (日本語)"}],N="en-US",x=(s,h)=>{const l=(s||"").toLowerCase(),r=(h||"").toUpperCase(),c=`${l}-${r}`.toLowerCase();if(k.some(o=>o.code.toLowerCase()===c&&l&&r))return c;if(l){const o=k.find(a=>a.code.toLowerCase().startsWith(`${l}-`));if(o)return o.code}return N},T=s=>{const{keyword:h,setKeyword:l,searchLanguage:r,country:c,ui:o}=s,a=h??"",[i,w]=t.useState(()=>x(r,c)),[j,b]=t.useState([]),[M,S]=t.useState(!1),[v,d]=t.useState(null),u=t.useRef(!1),e=t.useMemo(()=>R(o),[o]);t.useEffect(()=>{w(x(r,c))},[r,c]);const f=t.useCallback(async n=>{const C=n.trim();if(!C){b([]),d(null);return}S(!0),d(null);try{const p=new URLSearchParams({q:C,mkt:i,lang:(r||"").toLowerCase()}),m=await fetch(`/api/platforms/bing?${p.toString()}`);if(!m.ok){const E=await m.json().catch(()=>null);throw new Error(E?.error||e("platform.bing.error.fetch"))}const y=await m.json(),L=(Array.isArray(y?.suggestions)?y.suggestions:[]).map((E,F)=>({title:E,subtitle:e("platform.bing.subtitle",{market:y?.market||i}),metric:e("platform.bing.metric.rank",{rank:F+1})}));b(L),L.length===0&&d(e("platform.bing.error.none"))}catch(p){const m=p instanceof Error?p.message:e("platform.bing.error.generic");d(m),b([])}finally{S(!1)}},[i,r,e]);t.useEffect(()=>{if(!a.trim()){b([]),d(null),u.current=!1;return}u.current||(u.current=!0,f(a))},[a,f]),t.useEffect(()=>{a.trim()&&u.current&&f(a)},[i,a,f]);const A=g.jsx("div",{className:"platform-tool__filters",children:g.jsxs("label",{htmlFor:"bing-market",children:[e("platform.bing.filters.market"),g.jsx("select",{id:"bing-market",value:i,onChange:n=>{w(n.target.value),u.current=!1},children:k.map(n=>g.jsx("option",{value:n.code,children:n.label},n.code))})]})});return g.jsx(U,{platformName:e("platform.bing.meta.name"),keyword:a,onKeywordChange:l,onSearch:f,description:e("platform.bing.description"),extraFilters:A,results:j,placeholder:e("platform.bing.placeholder"),loading:M,error:v,emptyState:e("platform.bing.empty"),controls:s.locationControls,onGlobalSearch:s.onGlobalSearch,globalLoading:s.globalLoading,translate:e})};export{T as default};
