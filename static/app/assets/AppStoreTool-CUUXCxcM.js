import{r,c as B,j as m}from"./index-CNrdwjJ5.js";import{P as G}from"./PlatformToolLayout-Bh7vTboc.js";const R=[{code:"US",label:"United States"},{code:"GB",label:"United Kingdom"},{code:"CA",label:"Canada"},{code:"AU",label:"Australia"},{code:"DE",label:"Germany"},{code:"FR",label:"France"},{code:"ES",label:"Spain"},{code:"IT",label:"Italy"},{code:"NL",label:"Netherlands"},{code:"BE",label:"Belgium"},{code:"JP",label:"Japan"}],x=s=>{const y=(s||"").toUpperCase();return R.find(l=>l.code===y)?.code??"US"},O=s=>{const{keyword:y,setKeyword:g,country:l,ui:b}=s,o=y??"",[d,S]=r.useState(()=>x(l)),[v,p]=r.useState([]),[C,E]=r.useState(!1),[U,n]=r.useState(null),c=r.useRef(!1),t=r.useMemo(()=>B(b),[b]),P=r.useMemo(()=>R,[]);r.useEffect(()=>{S(x(l))},[l]);const i=r.useCallback(async a=>{const h=a.trim();if(!h){p([]),n(null);return}E(!0),n(null);try{const f=new URLSearchParams({q:h,country:d,limit:"15"}),u=await fetch(`/api/platforms/appstore?${f.toString()}`);if(!u.ok){const e=await u.json().catch(()=>null);throw new Error(e?.error||t("platform.appstore.error.fetch"))}const j=await u.json(),w=(Array.isArray(j?.results)?j.results:[]).map((e,k)=>{const A=e.trackName||h,L=[e.artistName,e.primaryGenreName].filter(Boolean),F=typeof e.averageUserRating=="number"?`${e.averageUserRating.toFixed(1)}★${e.userRatingCount?` (${e.userRatingCount.toLocaleString()})`:""}`:null,T=e.formattedPrice||(typeof e.price=="number"?e.price===0?t("platform.appstore.price.included"):`${e.price} ${e.currency||""}`:null),$=[F,T].filter(Boolean);return{title:A,subtitle:L.join(" • ")||void 0,metric:$.join(" • ")||t("platform.appstore.metric.rank",{rank:k+1})}});p(w),w.length===0&&n(t("platform.appstore.error.none"))}catch(f){const u=f instanceof Error?f.message:t("platform.appstore.error.generic");n(u),p([])}finally{E(!1)}},[d,t]);r.useEffect(()=>{if(!o.trim()){p([]),n(null),c.current=!1;return}c.current||(c.current=!0,i(o))},[o,i]),r.useEffect(()=>{o.trim()&&c.current&&i(o)},[d,o,i]);const N=m.jsx("div",{className:"platform-tool__filters",children:m.jsxs("label",{htmlFor:"appstore-country",children:[t("platform.appstore.filters.store"),m.jsx("select",{id:"appstore-country",value:d,onChange:a=>{S(a.target.value),c.current=!1},children:P.map(a=>m.jsx("option",{value:a.code,children:a.label},a.code))})]})});return m.jsx(G,{platformName:t("platform.appstore.meta.name"),keyword:o,onKeywordChange:g,onSearch:i,description:t("platform.appstore.description"),extraFilters:N,results:v,placeholder:t("platform.appstore.placeholder"),loading:C,error:U,emptyState:t("platform.appstore.empty"),controls:s.locationControls,onGlobalSearch:s.onGlobalSearch,globalLoading:s.globalLoading,translate:t})};export{O as default};
