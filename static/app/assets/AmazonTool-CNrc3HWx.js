import{r as t,A as v,c as K,j as s}from"./index-C6i-a171.js";import{P}from"./PlatformToolLayout-Z7gxyS7o.js";const p=v,U=n=>{const{keyword:E,setKeyword:w,country:x,ui:y,uiFallback:z}=n,r=E??"",[d,A]=t.useState(()=>{const a=(x??"").toUpperCase();return p.some(u=>u.code===a)?a:"US"}),[j,l]=t.useState([]),[C,k]=t.useState(!1),[L,c]=t.useState(null),m=t.useRef(!1),e=t.useMemo(()=>K(y,z),[y,z]),i=t.useMemo(()=>p.find(a=>a.code===d)??p[0],[d]),g=t.useCallback(async a=>{const u=a.trim();if(!u){l([]);return}k(!0),c(null);try{const f=new URLSearchParams({q:u,country:i.code,alias:"aps"}),o=await fetch(`/api/platforms/amazon?${f.toString()}`);if(!o.ok){const h=await o.json().catch(()=>null);throw new Error(h?.error||e("platform.amazon.error.fetch"))}const S=await o.json(),b=(Array.isArray(S?.suggestions)?S.suggestions:[]).map((h,R)=>({title:h,subtitle:e("platform.amazon.subtitle",{marketplace:i.label}),metric:e("platform.amazon.metric.rank",{rank:R+1})}));l(b),b.length===0&&c(e("platform.amazon.error.none"))}catch(f){const o=f instanceof Error?f.message:e("platform.amazon.error.generic");c(o),l([])}finally{k(!1)}},[i.code,i.label,e]);t.useEffect(()=>{m.current||r.trim()&&(m.current=!0,g(r))},[r,g]),t.useEffect(()=>{r.trim()||(l([]),c(null),m.current=!1)},[r]);const M=s.jsx("div",{className:"platform-tool__filters",children:s.jsxs("label",{htmlFor:"amazon-marketplace",children:[e("platform.amazon.filters.marketplace"),s.jsx("select",{id:"amazon-marketplace",value:d,onChange:a=>{A(a.target.value),m.current=!1},children:p.map(a=>s.jsx("option",{value:a.code,children:a.label},a.code))})]})});return s.jsx(P,{platformName:e("platform.amazon.meta.name"),keyword:r,onKeywordChange:w,onSearch:g,description:e("platform.amazon.description"),extraFilters:M,results:j,placeholder:e("platform.amazon.placeholder"),loading:C,error:L,emptyState:e("platform.amazon.empty"),controls:n.locationControls,onGlobalSearch:n.onGlobalSearch,globalLoading:n.globalLoading,translate:e})};export{U as default};
